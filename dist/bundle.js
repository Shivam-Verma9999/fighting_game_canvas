(()=>{"use strict";var t,e={d:(t,i)=>{for(var o in i)e.o(i,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};e.d({},{JQ:()=>d}),function(t){t[t.MoveLeft=0]="MoveLeft",t[t.MoveRight=1]="MoveRight",t[t.Crouch=2]="Crouch",t[t.Attack=3]="Attack",t[t.StopMoveLeft=4]="StopMoveLeft",t[t.StopMoveRight=5]="StopMoveRight",t[t.StopCrouch=6]="StopCrouch",t[t.StopAttack=7]="StopAttack",t[t.Jump=8]="Jump"}(t||(t={}));var i,o=function(){function e(t){this.player=void 0,this.registerPlayer(t)}return e.prototype.registerPlayer=function(t){this.player=t},e.prototype.doAction=function(e){switch(console.log("action : ".concat(e)),e){case t.MoveLeft:this.player.moveLeft();break;case t.MoveRight:this.player.moveRight();break;case t.Jump:this.player.jump();break;case t.Attack:this.player.attack();break;case t.StopAttack:this.player.stopAttack();break;case t.StopMoveLeft:this.player.stopLeftMovement();break;case t.StopMoveRight:this.player.stopRightMovement();break;default:console.log("Un-implemented action: ".concat(e))}},e}(),n=function(){function t(){}return t.setupControllers=function(t,e){this.controller1=t,this.controller2=e},t.dispatchAction=function(t,e){1===e?this.controller1.doAction(t):2===e?this.controller2.doAction(t):console.log("Unassigned controllerID: ".concat(e))},t.controller1=void 0,t.controller2=void 0,t}(),a=function(){function t(){}return t.initialize=function(){this.mapKeyControllerID("a",1),this.mapKeyControllerID("s",1),this.mapKeyControllerID("d",1),this.mapKeyControllerID("w",1),this.mapKeyControllerID("arrowup",2),this.mapKeyControllerID("arrowdown",2),this.mapKeyControllerID("arrowleft",2),this.mapKeyControllerID("arrowright",2),this.mapKeyControllerID(" ",1),this._initialized=!0},t.getMappedControllerID=function(t){this.throwIfNotInitialized();var e=this._map.get(t);return void 0===e?-1:e},t.mapKeyControllerID=function(t,e){this._map.set(t,e)},t.throwIfNotInitialized=function(){if(!this._initialized)throw new Error("KeyMapperNotInitialized")},t.unMapKeyControllerID=function(t){this.throwIfNotInitialized(),this._map.delete(t)},t._map=new Map,t._initialized=!1,t}();!function(t){t[t.Pressed=0]="Pressed",t[t.Released=1]="Released"}(i||(i={}));var s,r=function(){function e(){}return e.initialize=function(){this.mapKeyAction({key:"a",keyState:i.Pressed},t.MoveLeft),this.mapKeyAction({key:"s",keyState:i.Pressed},t.Crouch),this.mapKeyAction({key:"d",keyState:i.Pressed},t.MoveRight),this.mapKeyAction({key:"w",keyState:i.Pressed},t.Jump),this.mapKeyAction({key:" ",keyState:i.Pressed},t.Attack),this.mapKeyAction({key:"a",keyState:i.Released},t.StopMoveLeft),this.mapKeyAction({key:"s",keyState:i.Released},t.StopCrouch),this.mapKeyAction({key:"d",keyState:i.Released},t.StopMoveRight),this.mapKeyAction({key:" ",keyState:i.Released},t.StopAttack),this.mapKeyAction({key:"arrowleft",keyState:i.Pressed},t.MoveLeft),this.mapKeyAction({key:"arrowdown",keyState:i.Pressed},t.Crouch),this.mapKeyAction({key:"arrowright",keyState:i.Pressed},t.MoveRight),this.mapKeyAction({key:"arrowup",keyState:i.Pressed},t.Jump),this.mapKeyAction({key:"arrowleft",keyState:i.Released},t.StopMoveLeft),this.mapKeyAction({key:"arrowdown",keyState:i.Released},t.StopCrouch),this.mapKeyAction({key:"arrowright",keyState:i.Released},t.StopMoveRight)},e.mapKeyAction=function(t,e){var i=t.key,o=t.keyState;this._keyEventMap.set(JSON.stringify({key:i,keyState:o}),e)},e.getActionForKey=function(t){return console.log("getting action for ".concat(JSON.stringify(t))),this._keyEventMap.get(JSON.stringify(t))},e._keyEventMap=new Map,e._initialized=!1,e}(),h=function(){function t(){}return t.handle=function(t){var e=this;t.onkeydown=function(t){e.HandleKey(t.key.toString().toLowerCase(),i.Pressed)},t.onkeyup=function(t){e.HandleKey(t.key.toString().toLowerCase(),i.Released)}},t.HandleKey=function(t,e){var i=this.getActionAndControllerID({key:t,keyState:e}),o=i[0],n=i[1];void 0!==o&&-1!==n?this.dispatchAction(o,n):console.log("Action or controller Undefined ".concat(o," ").concat(n))},t.dispatchAction=function(t,e){n.dispatchAction(t,e)},t.getActionAndControllerID=function(t){var e=t.key,i=t.keyState;return console.log({key:e,keyState:i}),[r.getActionForKey({key:e,keyState:i}),a.getMappedControllerID(e)]},t}();!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(s||(s={}));var c=function(){function e(t,e,i){void 0===e&&(e=1),this.lastAction=void 0,this.initialJumps=2,this.jumpPower=-6,this.PlayerSpeed=1,this.velocity={x:0,y:1},this.weapon=null,this.id=t,this.x=i.x,this.y=i.y,this.height=i.height,this.width=i.width,this.color=i.color,this.totalJumpsAvailable=this.initialJumps,this.PlayerSpeed=e}return e.prototype.getDrawableCords=function(){return this},e.prototype.setWeapon=function(t){this.weapon=t},e.prototype.getMovementDirection=function(){return this.lastAction===t.MoveLeft?s.Left:this.lastAction===t.MoveRight?s.Right:void 0},e.prototype.directionMultiplier=function(){return this.getMovementDirection()===s.Left?-1:1},e.prototype.getWeaponForDraw=function(){var t=this.weapon.isActive?this.weapon.width:this.weapon.height,e=this.weapon.isActive?this.weapon.height:this.weapon.width;return{color:this.weapon.color,x:this.x+this.width*this.directionMultiplier(),y:this.y,height:-t,width:e*this.directionMultiplier()}},e.prototype.updatePos=function(){this.velocity.y+=.2,this.x+this.width+this.velocity.x>=d.width&&(this.velocity.x=0),this.y+this.height+this.velocity.y>=d.height-35&&(this.velocity.y=0,this.totalJumpsAvailable=this.initialJumps),this.x+=this.velocity.x,this.y+=this.velocity.y},e.prototype.activateWeapon=function(){this.weapon.isActive=!0},e.prototype.deactivateWeapon=function(){this.weapon.isActive=!1},e.prototype.jump=function(){0!=this.totalJumpsAvailable&&(this.velocity.y=this.jumpPower,this.totalJumpsAvailable--)},e.prototype.moveLeft=function(){this.velocity.x=-this.PlayerSpeed,this.lastAction=t.MoveLeft},e.prototype.moveRight=function(){this.velocity.x=this.PlayerSpeed,this.lastAction=t.MoveRight},e.prototype.stopMovement=function(){this.velocity.x=0},e.prototype.stopLeftMovement=function(){this.getMovementDirection()===s.Left&&(this.velocity.x=0)},e.prototype.stopRightMovement=function(){this.getMovementDirection()===s.Right&&(this.velocity.x=0)},e.prototype.attack=function(){this.activateWeapon()},e.prototype.stopAttack=function(){this.deactivateWeapon()},e}(),l=function(t,e){void 0===t&&(t={x:0,y:0,height:30,width:5,color:"yellow"}),void 0===e&&(e=10),this.color=t.color,this.height=t.height,this.width=t.width,this.isActive=!1,this.damage=e},p=new Image;p.src="./assets/images/mast_head.png";var y=new Image;y.src="./assets/images/game_level_background.webp";var d=new(function(){function t(t){this._height=t.height,this._width=t.width,this._id=t.id,this._backgroundColor=t.backgroundColor}return t.prototype.initialize=function(){if(console.log("Finding canvas with id: '".concat(this._id,"' ...")),this._canvasElement=document.getElementById(this._id),null===this._canvasElement)throw new Error("Cannot find canvas");if(this._canvasElement.height=this.height,this._canvasElement.width=this.width,console.log("Canvas found with id: '".concat(this._id,"'")),this._canvas=this._canvasElement.getContext("2d"),null===this._canvas)throw new Error("Unable to get 2d context");console.log("Context Ready...")},Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){console.log("setting height"),this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){console.log("setting height"),this._width=t},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._canvas.drawImage(y,530,150,this.width,this.height,0,0,this.width,this.height)},t.prototype.draw=function(t){var e=this;t.forEach((function(t){t instanceof c&&(e.drawObject(t),e.drawObject(t.getWeaponForDraw()))}))},t.prototype.drawMastHead=function(){this._canvas.drawImage(p,0,0)},t.prototype.drawObject=function(t){this._canvas.fillStyle=t.color,this._canvas.fillRect(t.x,t.y,t.width,t.height)},t}())({id:"canvas",height:500,width:1e3,backgroundColor:"black"});d.initialize();var u=new c(1,3,{x:100,y:100,height:50,width:5,color:"red"}),f=new c(2,2,{x:400,y:100,height:50,width:5,color:"green"}),g={x:0,y:0,height:30,width:5,color:"white"};u.setWeapon(new l(g,10)),f.setWeapon(new l(g,10)),r.initialize(),a.initialize(),n.setupControllers(new o(u),new o(f)),h.handle(window),function t(){window.requestAnimationFrame(t),d.clear(),d.drawMastHead(),d.draw([u,f]),u.updatePos(),f.updatePos()}()})();